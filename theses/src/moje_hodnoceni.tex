\subsection{Hodnotící algoritmus a ztrátová tabulka}
Po získání testovaného popisu je potřeba jej srovnat s referenčním popisem a ohodnotit míru jejich shody.
K tomuto účelu byl navržen a implementován hodnotící algoritmus, který byl detailně popsán v kapitole~\ref{subsec:hodnoceni}.

Vstupem je referenční popis získaný od experta, testovaný popis, jehož získání je popsáno v předchozích kapitolách a ztrátová tabulka,
která udává závažnost různých chyb.
Samotná ztrátová tabulka odpovídá svým formátem asociativnímu poli (též hash-tabulka nebo slovník), s předem danou strukturou.
Jelikož je SPGF systém citlivý na velikost písmen a interpunkční znaménka, jsou texty před vstupem normalizované
a zpracovávané větu po větě, výsledky pro jednotlivé věty jsou na konči sloučené.

Jak již bylo řečeno v kapitole~\ref{subsec:hodnoceni}, ztrátovou tabulku sestavuje expert, stejně jako referenční popis a SPGF gramatiky.
Z toho důvodu bylo nutné zvolit nějaký formát, který by byl čitelný člověkem a zároveň zpracovatelný strojem.
Zvolen byl opět formát \texttt{JSON}, který představuje dobrý kompromis mezi oběma faktory.

Ukázka ztrátové tabulky je na Výpisu~\ref{lst:loss_table_example}.

\newpage
\input{src/listings/loss.tex}

Význam jednotlivých položek byl detailně popsán v sekci~\ref{subsec:hodnoceni}, proto zde bude pouze stručně shrnuto,
který klíč odpovídá jakému významu:
\begin{itemize}
	\item \texttt{missing\_objects} \to\ výchozí ztráta pro chybějící objekty,
	\item \texttt{missing\_attributes} \to\ výchozí ztráta pro chybějící atributy,
	\item \texttt{missing\_triplets} \to\ výchozí ztráta pro chybějící triplety (vazby),
	\item \texttt{numberless\_penalty} \to\ ztráta pro informace obsahující objekty s chybějícím číslováním (viz sekce~\ref{subsubsec:cislovani_objektu}),
	\item \texttt{wrong\_value} \to\ výchozí ztráta pro atributy s chybnou hodnotou,
	\item \texttt{missing\_objects\_override} \to\ seznam konkrétních ztrát pro chybějící objekty s daným tagem,
	\item \texttt{missing\_attributes\_override} \to\ seznam konkrétních ztrát pro chybějící atributy (podle názvu atributu),
	\item \texttt{missing\_triplets\_override} \to\ seznam konkrétních ztrát pro chybějící triplety (podle názvu vazby),
	\item \texttt{wrong\_values\_override} \to\ seznam konkrétních ztrát pro daný atribut a případně i pro záměnu konkrétních hodnot.
\end{itemize}

Finálním výstupem hodnotícího algoritmu je množina označených číselných hodnot, získaných akumulací ztrát pro různé druhy chyb.
Přirozenou datovou strukturou, která by odpovídala tomuto formátu, by bylo asociativní pole.

Příkladem takového výstupu může být Výpis~\ref{lst:output_example}.

\newpage
\begin{lstlisting}[
	% there are many more options of styling, see the official documentation, these are just the defaults I like
	frame=single, % make single-line frame around the verbatim
	framesep=2mm, % put some more spacing between the frame and text
	aboveskip=5mm, % put some more space above the box
	basicstyle={\linespread{0.9}\small\ttfamily}, % use typewriter (monospace) font
	caption={Ukázka výpisu hodnocení (zkráceno)}, % set the caption text
	captionpos=b, % put the caption at the bottom (b) or top (t) or both (bt)
	label={lst:output_example}, % label to be referenced via \ref{}
	numbers=left, % line numbers on the left
	numberstyle={\scriptsize\ttfamily\color{black!60}}, % the style for line numbers
	% escapeinside={<@}{@>} % between those sequences are command evaluated
]
Score {
    missing_objects: 125.5,
    missing_attributes: 79.5,
    missing_triplets: 164.0,
    wrong_values: 0.0,
    grouped_missing_objects: {
        "group": 21.0,
        "item": 24.0,
        "person": 5.5,
        "animal": 52.0,
        "clothing": 24.0,
        "environment": 17.0,
        "background": 15.0,
        ...
    },
    grouped_missing_attributes: {
        "hairstyle": 1.0,
        "pattern": 1.0,
        "action": 5.0,
        "color": 61.0,
        "facial expression": 0.5,
        ...
    },
    grouped_missing_triplets: {
        "reading": 0.0,
        "climbing": 2.0,
        "throwing": 2.0,
        "playing with": 6.0,
        "chasing": 2.0,
        "swimming in": 2.0,
        "following": 10.0,
        "running away from": 2.0,
        "has child object": 70.0,
        "sitting on": 8.0,
        "wearing": 20.0,
        ...
    },
    grouped_wrong_values: {
        "state": 0.0,
        "facial expression": 0.0,
        "pattern": 0.0,
        "color": 0.0,
        "count": 2.0,
        ...
    },
}
\end{lstlisting}
